# Lab 2: Развертывание backend-приложения

В данной лабораторной работе вы будете использовать репозиторий GitVerse с исходным кодом готовых backend-приложений на языках Python, Go, Java Script, C#. Каждое приложение является простым примером реализации REST API, которое возвращает список значений с демонстрационными данными. На этих примерах вы познакомитесь с дополнительными настройками облачного сервиса Container Apps.

### 1. (Опционально) Клонируйте или скачайте репозиторий кода c GitVerse

```
git clone https://gitverse.ru/sc/cloudru/evo-containerapp-restapi-js-go-python-dotnet-sample.git 
``` 
В данном репозитории находится исходный код простого REST API приложения, написанного на разных языках: Java Script, Python, Go, C#.

### 2. Соберите образ и присвойте тег 
Используйте реестр, созданный в предыдущей лабораторной работе, выполнив следующие команды:

```shell
docker build --tag <registry_name>.cr.cloud.ru/restapi-python https://gitverse.ru/sc/cloudru/evo-containerapp-restapi-js-go-python-dotnet-sample.git#master:restapi-python/src --platform linux/amd64
```

### 3. Загрузите Docker-образ в реестр

Загрузите образ в реестр Artifact Registry, выполнив команду:

```bash
docker push <registry_name>.cr.cloud.ru/restapi-python
```

### 4. Создайте и запустите контейнер

Откройте меню загруженного образа и нажмите **Создать Container App**. 

![revision-running](images/lab1/run_from_ar.png)

Заполните поля и активируйте опции:

![run_from_ar_form](images/lab1/run_from_ar_form.png)

**Название контейнера** — глобально уникальное имя, на базе которого формируется адрес вашего приложения в домене *.containers.cloud.ru.

**Порт контейнера** — порт контейнера, который должен совпадать с портом вашего приложения. В этой лабораторной работе используем порт 8080.

**vCPU/RAM** — количество vCPU и RAM, которые выделяются для каждого экземпляра контейнера при обработке вызова. Выберите минимальную конфигурацию.

**Минимальное** и **максимальное количество экземпляров** при масштабировании сервиса. По умолчанию происходит масштабирование с 0, что может вызывать небольшую задержку при старте вашего приложения. Установите минимальное количество экземпляров в значение 0, а максимальное — 1.

**Публичный адрес**— активируйте опцию, чтобы получить URL-адрес для вызова контейнера из интернета.

**Автоматическое развертывание** — если опция активирована, то каждый раз после загрузки в Artifact Registry новой версии образа на стороне Container Apps будет автоматически создаваться новая ревизия контейнера на базе обновленной версии Docker-образа. 

Нажмите **Создать**.

Откроется страница сервиса Container Apps. 
Контейнер будет запущен в течение нескольких секунд.

Когда контейнер перейдет в статус **Выполняется**, значит он успешно запущен.

![revision-running](images/lab1/ca_running.png)

### 5. Проверьте рабостоспособность развернутного приложения

Дождитесь появления **Публичного URL**, скопируйте его и вставьте в адресную строку браузера.

Если приложение не отвечает, перейдите в список ревизий и убедитесь, что последняя созданная ревизия (идет первой в списке) находится в статусе **Выполняется**.

![revision-running](images/lab1/revision_running.png)
    
:thumbsup: Поздравляем, вы только что развернули REST API — приложение в облачном контейнере и опубликовали его в интернет!  

### Заключение
В данной лабораторной работе вы научились:

- создавать репозитории в существующих реестрах Artifact Registry;
- создавать контейнер и запускать контейнер в Container Apps;
- управлять настройками масштабирования. 

В следующей лабораторной работе вы научитесь развертывать fullstack-приложения.